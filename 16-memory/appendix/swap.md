### Создание swap-файла

Если у пользователя без явных причин начинает виснуть компьютер, дело может быть в отсутствии swap (в терминологии Windows - файл подкачки)

Swap в Linux - это механизм, который позволяет операционной системе использовать часть жесткого диска в качестве виртуальной памяти, когда физическая память (RAM) исчерпана.

Когда операционная система Linux работает, она хранит данные и инструкции в физической памяти RAM для быстрого доступа. Однако, если физической памяти недостаточно для хранения всех запущенных процессов и данных, то используется механизм swap.

Swap разбивает использование диска на небольшие блоки, называемые страницами. Операционная система перемещает неиспользуемые страницы физической памяти на диск в swap-раздел или файл swap. Когда эти страницы снова требуются, операционная система перемещает их обратно в физическую память и загружает другие неиспользуемые страницы на диск.

Swap может быть реализован как отдельный раздел на жестком диске или файл в файловой системе. Создание и настройка swap-раздела выполняется с помощью инструмента mkswap. Файл swap может быть создан командой dd или mkswap.

Linux использует так называемый «swappiness», чтобы определить, насколько активно используется swap. Это значение, указывающее операционной системе, когда страницы должны быть перемещены на диск. Значение swappiness может находиться в диапазоне от 0 до 100, где 0 означает использование swap только в случае, крайнего необходимости, а 100 - использование swap почти всегда.

Swap в Linux играет важную роль в обеспече

3. chmod 600 /swapfile : Эта команда устанавливает права доступа к файлу /swapfile только для пользователя (владельца), запрещая доступ группы и других пользователей. Права доступа 600 означают чтение и запись для владельца, без доступа для всех остальных.

4. mkswap /swapfile : Эта команда создает область swap в файле /swapfile , подготавливая его для использования в качестве swap-раздела. Она создает специальные метаданные, необходимые для работы swap в Linux.

5. swapon /swapfile : Данная команда активирует swap-раздел /swapfile , добавляя его в список доступных swap-устройств, которые система может использовать для виртуальной памяти.

6. echo "/swapfile swap swap defaults 0 0" >> /etc/fstab : В этой команде используется echo для добавления строки /swapfile swap swap defaults 0 0 в конец файла /etc/fstab . Файл /etc/fstab содержит информацию о файловых системах и описывает, какие устройства и разделы должны быть смонтированы при загрузке системы. Добавление этой строки в /etc/fstab гарантирует, что swap-раздел /swapfile будет автоматически активирован при каждой загрузке системы.

Эта последовательность команд создает файл /swapfile , устанавливает его как swap-раздел, активирует его и настраивает автоматическую активацию при загрузке системы.нии стабильности и продолжительности работы системы.

В Linux в swap могут отправляться неиспользуемые страницы памяти. Это включает в себя следующие категории:

1. Неактивные страницы памяти: Это страницы, которые не были использованы в течение некоторого времени и не содержат важных данных. Они отправляются в swap, чтобы освободить место в физической памяти для более активных страниц.

2. Страницы, занятые неактивными процессами: Если процесс не активен, он может использовать меньше физической памяти, чем было выделено. Эти неиспользуемые страницы памяти могут быть отправлены в swap.

3. Кэшированные страницы памяти: Linux использует кэширование для ускорения доступа к файлам и другим данным. Кэшированные страницы могут быть подвержены перемещению в swap, если они не используются или есть нужда в освобождении физической памяти.

Важно понимать, что страницы памяти в swap будут загружены обратно в физическую память, когда они снова понадобятся. Это может вызвать дополнительную нагрузку на систему из-за операций чтения и записи на диск. Поэтому оптимальное использование swap должно быть согласовано с учетом специфических требований и настроек системы.

Проверить, есть ли swap, можно, например, с помощью команды free -h
```
# free -h

total used free shared buff/cache available
Mem: 7,5Gi 998Mi 780Mi 459Mi 5,7Gi 5,7Gi
Swap: 4,0Gi 0B 4,0Gi
```
Тут мы видим, что есть как физическая память (строка Mem: ), так и swap (строка Swap: )

Если строка swap отсутствует, может иметь смысл ее создать. В одну команду это можно сделать так (от пользователя root):
```shell
fallocate -l 4G /swapfile
dd if=/dev/zero of=/swapfile bs=1024 count=4194304
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile
echo "/swapfile swap swap defaults 0 0">> /etc/fstab
```
Давайте разберем последовательность команд:

1. fallocate -l 4G /swapfile : Данная команда создает файл /swapfile заданного размера 4 гигабайта с помощью fallocate . Этот файл будет использоваться в качестве swap-раздела.

2. dd if=/dev/zero of=/swapfile bs=1024 count=4194304 : Следующая команда dd , используя источник данных /dev/zero , заполняет файл /swapfile нулями. Она использует блок размером в 1024 байта, и общее количество блоков равно 4194304, что соответствует 4 гигабайтам.

3. chmod 600 /swapfile : Эта команда устанавливает права доступа к файлу /swapfile только для пользователя (владельца), запрещая доступ группы и других пользователей. Права доступа 600 означают чтение и запись для владельца, без доступа для всех остальных.

4. mkswap /swapfile : Эта команда создает область swap в файле /swapfile , подготавливая его для использования в качестве swap-раздела. Она создает специальные метаданные, необходимые для работы swap в Linux.

5. swapon /swapfile : Данная команда активирует swap-раздел /swapfile , добавляя его в список доступных swap-устройств, которые система может использовать для виртуальной памяти.

6. echo "/swapfile swap swap defaults 0 0" >> /etc/fstab : В этой команде используется echo для добавления строки /swapfile swap swap defaults 0 0 в конец файла /etc/fstab . Файл /etc/fstab содержит информацию о файловых системах и описывает, какие устройства и разделы должны быть смонтированы при загрузке системы. Добавление этой строки в /etc/fstab гарантирует, что swap-раздел /swapfile будет автоматически активирован при каждой загрузке системы.

Эта последовательность команд создает файл /swapfile , устанавливает его как swap-раздел, активирует его и настраивает автоматическую активацию при загрузке системы.