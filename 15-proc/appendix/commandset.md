# Less15. PROC

–°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
- fork() - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
- exec() - –∑–∞–≥—Ä—É–∑–∫–∞ (–∑–∞–ø—É—Å–∫) –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤ –ø—Ä–æ—Ü–µ—Å—Å
- exit() - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã (–Ω–µ –ø—Ä–æ—Ü–µ—Å—Å–∞)
- wait() - —Å—á–∏—Ç—ã–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞

```bash
 ‚ï≠‚îÄalex@smith in ~ as üßô took 40s
[üî¥] √ó ls -l /sbin/init
lrwxrwxrwx 1 root root 22 –∞–ø—Ä 19 03:42 /sbin/init -> ../lib/systemd/systemd

```
![](./screenshot1.png)


## –°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã:

    - fork() —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å)
        |- parent proc (–∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ä–∞–≤–Ω—ã–π PID –¥–æ—á–µ—Ä–Ω–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞)
        |- child proc (–¥–æ—á–µ—Ä–Ω–µ–º—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0)
        —Å—Ç–∞—Ä—Ç—É–µ—Ç –≤ –æ–¥–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ, –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –≤ –¥–≤—É—Ö

    exec() - —Å–ø–æ—Å–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –≤ Linux
        ‚óè —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –ø—Ä–æ—Ü–µ—Å—Å–µ
        ‚óè –∑–∞–º–µ–Ω—è–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–∞ —Ç—É, —á—Ç–æ –±—ã–ª–∞ –ø–µ—Ä–µ–¥–∞–Ω–∞ exec() –≤ –∫–∞—á-–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞
        ‚óè exec() - —Å–µ–º–µ–π—Å—Ç–≤–æ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ (execl, execle, execlp, execv, execve, execvp)

    exit() - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤ Linux
        ‚óè –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ–±—ã—á–Ω–æ–º—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –ø—Ä–æ–≥—Ä–∞–º–º—ã
        ‚óè –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã –µ–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è status –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞
        —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É –ø—Ä–æ—Ü–µ—Å—Å—É (status - –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞)
        ‚óè exit() - –Ω–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å

    wait() ‚Äì —Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ –¥–æ—á–µ—Ä–Ω–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ Linux
        ‚óè –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –¥–æ—á–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
        ‚óè –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ –¥–æ—á–µ—Ä–Ω–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
        ‚óè –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ wait() –¥–æ—á–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ —Å–∏—Å—Ç–µ–º—ã

## –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ Linux
![](./screenshot2.png)

0:32 

    - exec() –∑–∞–≥—Ä—É–∑–∫–∞ (–∑–∞–ø—É—Å–∫) –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤ –ø—Ä–æ—Ü–µ—Å—Å
    - exit() –Ω–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å, —Ç–µ–ø–µ—Ä—å –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å status - –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞. –¢–æ–ª—å–∫–æ —Ä–æ–¥–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å—á–∏—Ç–∞—Ç—å –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ 
        *
    - wait() —Å—á–∏—Ç—ã–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
        –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç –ø–æ—Ç–æ–º–∫–∞ –∫–æ–¥–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞, –ø—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å

## –°–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞:
    - R –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è (—Å–∞–º—ã–π –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π)
    - S –æ–∂–∏–¥–∞–Ω–∏–µ
    - D –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞
    - T –ø—Ä–æ—Ü–µ—Å—Å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
    - Z –∑–æ–º–±–∏ (—Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É exit() –∏ wait())
        |- –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ª—é–±–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
        |- –Ω–µ –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç —Ä–µ—Å—É—Ä—Å–æ–≤
        |- –µ–≥–æ –Ω–µ–ª—å–∑—è –∑–∞–≤–µ—Ä—à–∏—Ç—å


> –î–µ–º–æ–Ω - –ø—Ä–æ—Ü–µ—Å—Å, —Ä–∞–±–æ—Ç–∞—é—â–∏–π –≤ —Ñ–æ–Ω–µ –±–µ–∑ –ø—Ä—è–º–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

## Zombi

–Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞

![](./screenshot4.png)

### –°–∏—Ä–æ—Ç–∞
    ‚óè –ø—Ä–æ—Ü–µ—Å—Å –æ—Å—Ç–∞–≤—à–∏–π—Å—è –±–µ–∑ —Ä–æ–¥–∏—Ç–µ–ª—è
    ‚óè –±—É–¥–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —É—Å—ã–Ω–æ–≤–ª–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å–æ–º init (–≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö systemd)
    ‚óè —è–≤–ª–µ–Ω–∏–µ –æ—á–µ–Ω—å –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ (—É–≤–∏–¥–µ—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Å–∏—Ä–æ—Ç—É –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è)

### –ö–∞–∫ —É–±–∏—Ç—å –∑–æ–º–±–∏?
–ê –Ω—É–∂–Ω–æ –ª–∏...?

        ‚óè —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ —Å–∏—Ä–æ—Ç–æ–π
        ‚óè –∑–∞—Å—Ç–∞–≤–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—è –ø–æ—Å–ª–∞—Ç—å wait()

    kthreadd - —Ä–æ–¥–∏—Ç–µ–ª—å –ø–æ—Ç–æ–∫–æ–≤ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ —è–¥—Ä–∞
    [] - –ø–æ—Ç–æ–∫–∏ —è–¥—Ä–∞ 

## –ü—Ä–∞–∫—Ç–∏–∫–∞
1:00

``` ps -efl```

1:27 - —Ä–∞–∑–±–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –∫–∞—Ç–∞–ª–æ–≥ PROC 
```
lsof - –∏—Ñ–Ω –æ–± –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–∞—Ö
ls -l /proc 

/proc/*/exe     - –±–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã
/proc/*/fd      - –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã
/proc/*/maps    - –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –±–∏–±–ª–∏–æ—Ç–µ–∫ (.so)



```
1:30 - 1:50 –¥–ª—è –î–ó


```bash
# –Ω–∞–π–¥–µ–º –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å
ls -l /proc/*/task 2> /dev/null
[root@smith ~]# ls -l /proc/687589/task
–∏—Ç–æ–≥–æ 0
dr-xr-xr-x 7 alex alex 0 –∏—é–ª  8 11:42 687589
dr-xr-xr-x 7 alex alex 0 –∏—é–ª  8 11:42 687590
dr-xr-xr-x 7 alex alex 0 –∏—é–ª  8 11:42 687591
dr-xr-xr-x 7 alex alex 0 –∏—é–ª  8 11:42 687592
dr-xr-xr-x 7 alex alex 0 –∏—é–ª  8 11:42 687593
dr-xr-xr-x 7 alex alex 0 –∏—é–ª  8 11:42 687594
dr-xr-xr-x 7 alex alex 0 –∏—é–ª  8 11:42 687595
dr-xr-xr-x 7 alex alex 0 –∏—é–ª  8 11:42 687596
dr-xr-xr-x 7 alex alex 0 –∏—é–ª  8 11:42 687598
dr-xr-xr-x 7 alex alex 0 –∏—é–ª  8 11:42 687603
[root@smith ~]# ls -l /proc/687589/exe
lrwxrwxrwx 1 alex alex 0 –∏—é–ª  8 11:42 /proc/687589/exe -> /opt/visual-studio-code/code

```

strace - –≤—Å–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã 
```bash
[root@smith ~]# strace -e trace=process ls
execve("/usr/bin/ls", ["ls"], 0x7ffec5937b60 /* 40 vars */) = 0
ansible  nano.943634.save
exit_group(0)                           = ?
+++ exited with 0 +++

```