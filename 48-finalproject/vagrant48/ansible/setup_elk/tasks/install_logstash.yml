---
- name: Install a logstash-8.9.1-amd64 package
  ansible.builtin.apt:
    deb: "{{ distrib_path }}/elk-8.9-deb/logstash-{{ elk_version }}-amd64.deb"
    state: present
  tags: install

- name: Set up logstash
  ansible.builtin.template:
    src: logstash.yml.j2
    dest: /etc/logstash/logstash.yml
    mode: "0644"
    owner: root

- name: Set up logstash conf
  ansible.builtin.template:
    src: logstash-nginx-es.conf.j2
    dest: /etc/logstash/conf.d/logstash-nginx-es.conf
    mode: "0644"
    owner: root

- name: Start logstash
  ansible.builtin.systemd:
    name: logstash
    daemon-reload: true
    enabled: true
    state: started
