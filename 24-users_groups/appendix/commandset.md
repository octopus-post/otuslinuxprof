# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –≥—Ä—É–ø–ø—ã. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- [–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –≥—Ä—É–ø–ø—ã. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è](#–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏-–∏-–≥—Ä—É–ø–ø—ã-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è-–∏-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
- [1. –ë–∞–∑–æ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è –∏ ACL](#1-–±–∞–∑–æ–≤—ã–µ-–ø–æ–Ω—è—Ç–∏—è-–∏-acl)
  - [AAA (Authentication, Authorization, Accountig)](#aaa-authentication-authorization-accountig)
  - [–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏](#–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
    - [–¢–∏–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π](#—Ç–∏–ø—ã-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
    - [/etc/passwd ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π](#etcpasswd--—Å–ø–∏—Å–æ–∫-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
    - [/etc/group ‚Äî –≥—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π](#etcgroup--–≥—Ä—É–ø–ø—ã-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
    - [/etc/shadow ‚Äî –ø–∞—Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π](#etcshadow--–ø–∞—Ä–æ–ª–∏-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
    - [Authentication](#authentication)
    - [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)
    - [–ú–µ—Ö–∞–Ω–∏–∑–º sudo](#–º–µ—Ö–∞–Ω–∏–∑–º-sudo)
    - [–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º](#–ø—Ä–∞–≤–∞-–¥–æ—Å—Ç—É–ø–∞-–∫-—Ñ–∞–π–ª–∞–º)
      - [–ë–∏—Ç—ã –¥–æ—Å—Ç—É–ø–∞](#–±–∏—Ç—ã-–¥–æ—Å—Ç—É–ø–∞)
      - [–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –±–∏—Ç—ã](#—Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ-–±–∏—Ç—ã)
      - [umask –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é](#umask-–∏-–ø—Ä–∞–≤–∞-–¥–æ—Å—Ç—É–ø–∞-–ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é)
  - [ACL access control list](#acl-access-control-list)
      - [getfacl](#getfacl)
      - [setfacl](#setfacl)
      - [–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã —Ñ–∞–π–ª–æ–≤](#—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ-–∞—Ç—Ä–∏–±—É—Ç—ã-—Ñ–∞–π–ª–æ–≤)
- [2. Capabilities (–ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏)](#2-capabilities-–ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏)
    - [—Ñ–ª–∞–≥–∏ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞](#—Ñ–ª–∞–≥–∏-–¥–ª—è-–ø—Ä–æ—Ü–µ—Å—Å–∞)
    - [—Ñ–ª–∞–≥–∏ –¥–ª—è —Ñ–∞–π–ª–∞](#—Ñ–ª–∞–≥–∏-–¥–ª—è-—Ñ–∞–π–ª–∞)
    - [–ø—Ä–æ—Å–º–æ—Ç—Ä –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞](#–ø—Ä–æ—Å–º–æ—Ç—Ä-–∏-—Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞)
    - [—É—Ç–∏–ª–∏—Ç—ã](#—É—Ç–∏–ª–∏—Ç—ã)
    - [—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–Ω–∞—Å—Ç—Ä–æ–µ–∫)
- [3. polkit (PolicyKit)](#3-polkit-policykit)
    - [—É—Ç–∏–ª–∏—Ç—ã](#—É—Ç–∏–ª–∏—Ç—ã-1)
- [4. PAM (Pluggable Authentication Modules)](#4-pam-pluggable-authentication-modules)
    - [–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
    - [–¢–∏–ø—ã –º–æ–¥—É–ª–µ–π](#—Ç–∏–ø—ã-–º–æ–¥—É–ª–µ–π)
    - [control](#control)
    - [pam\_script](#pam_script)


# 1. –ë–∞–∑–æ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è –∏ ACL

## AAA (Authentication, Authorization, Accountig)
- **Authentication** (–ø—Ä–æ—Ü–µ—Å—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Å–≤–æ–µ–π –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏)
    - –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å

- **Authorization** (–Ω–∞–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∞–≤–∞–º–∏)
    - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–∫–∏–º-–ª–∏–±–æ
–æ–±—ä–µ–∫—Ç–∞–º

- **Accountig** (–∑–∞–ø–∏—Å—å –∏–Ω—Ñ –æ –ø—Ä–æ–∏–∑–æ—à–µ–¥—à–∏—Ö —Å–æ–±—ã—Ç–∏—è—Ö)

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
### –¢–∏–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

|            |                   |                               |                                 |
| ---------- | ----------------- | ----------------------------- | ------------------------------- |
|            | —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å          | —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å          |
|            | root              | user                          | daemon                          |
|            | UID=0             | UID >1000                     | UID < 1000                      |
| home       | /root             | /home/user                    | –æ—Ç—Å—Ç—É—Ç—Å—Ç–≤—É–µ—Ç, –ª–∏–±–æ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–∞—è |
| –ø–∞—Ä–æ–ª—å     | –Ω–µ –≤—Å–µ–≥–¥–∞         | —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω                    | –Ω–µ—Ç                             |
| shell      | +                 | +                             | -                               |
| –ø–æ–ª–Ω–æ–º–æ—á–∏—è | –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ    | –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–æ–º–∞—à–Ω–µ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ | –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ãe                    |
|            |

###    /etc/passwd ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```bash
 ‚ï≠‚îÄalex@smith in ~ took 3s
[üß±] √ó sudo cat  /etc/passwd
[sudo] –ø–∞—Ä–æ–ª—å –¥–ª—è alex:         
root:x:0:0::/root:/bin/bash
bin:x:1:1::/:/usr/bin/nologin
daemon:x:2:2::/:/usr/bin/nologin
mail:x:8:12::/var/spool/mail:/usr/bin/nologin
ftp:x:14:11::/srv/ftp:/usr/bin/nologin
http:x:33:33::/srv/http:/usr/bin/nologin
nobody:x:65534:65534:Kernel Overflow User:/:/usr/bin/nologin
...
stunnel:x:16:16::/var/run/stunnel:/usr/bin/nologin
smith:x:1001:1001::/home/smith:/usr/bin/bash
alpm:x:951:951:Arch Linux Package Management:/:/usr/bin/nologin
```
> - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
> - –¶–∏—Ñ—Ä–æ–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (UID)
> - –¶–∏—Ñ—Ä–æ–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ—Å–Ω–æ–≤–Ω–æ–π –≥—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (GID)
> - –ü–æ–ª–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
> - –î–æ–º–∞—à–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
> - –û–±–æ–ª–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º

###    /etc/group ‚Äî –≥—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```bash
 ‚ï≠‚îÄalex@smith in ~ as üßô took 2s
 ‚ï∞‚îÄŒª sudo cat  /etc/group
[sudo] –ø–∞—Ä–æ–ª—å –¥–ª—è alex:         
root:x:0:brltty,root
sys:x:3:bin,alex,smith
...
nobody:x:65534:
...
alex:x:1000:
...
smith:x:1001:
alpm:x:951:
virtlogin:x:950:
```
> - –ò–º—è –≥—Ä—É–ø–ø—ã
> - –ü–∞—Ä–æ–ª—å –≥—Ä—É–ø–ø—ã
> - –¶–∏—Ñ—Ä–æ–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≥—Ä—É–ø–ø—ã (GID)
> - –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≤—Ö–æ–¥—è—â–∏—Ö –≤ —ç—Ç—É –≥—Ä—É–ø–ø—É, –∫–∞–∫ –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é
> - –û—Å–Ω–æ–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî –≤ /etc/passwd

###    /etc/shadow ‚Äî –ø–∞—Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```bash
 ‚ï≠‚îÄalex@smith in ~ as üßô took 2s
 ‚ï∞‚îÄŒª sudo cat  /etc/shadow
root:$6$iP9.A8xYP//:19749::::::
bin:!*:19659::::::
daemon:!*:19659::::::
mail:!*:19659::::::
ftp:!*:19659::::::
http:!*:19659::::::
nobody:!*:19659::::::
...
polkitd:!*:19659::::::
rtkit:!*:19659::::::
alex:$6$APMz/:19749:0:99999:7:::
...
smith:GEKyA3:19749:0:99999:7:::
```
> - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ –∏–º—è
> - –ó–∞—Ö—ç—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å
> - –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
> - –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –¥–Ω–µ–π –º–µ–∂–¥—É –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –ø–∞—Ä–æ–ª—è
> - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –¥–Ω–µ–π –º–µ–∂–¥—É –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –ø–∞—Ä–æ–ª—è
> - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø–∞—Ä–æ–ª—è
> - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø–∞—Ä–æ–ª—è
> - –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏
> - –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–ª–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –≤—Å–µ–≥–¥–∞ –ø—É—Å—Ç–æ

### Authentication

    ‚óè –£—Å–ª–æ–≤–∏—è –¥–ª—è –≤—Ö–æ–¥–∞:
        ‚óã shell –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –∏ –±—ã—Ç—å –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–º –≤ /etc/shells
        ‚óã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞—Ä–æ–ª—å
    ‚óè –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
        ‚óã —É—Å—Ç–∞–Ω–æ–≤–∫–∞ shell –≤ /bin/nologin
        ‚óã —É—Å—Ç–∞–Ω–æ–≤–∫–∞ expiry date –≤ –ø—Ä–æ—à–ª–æ–µ
        ‚óã –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–∞—Ä–æ–ª—è (–¥–µ–ª–∞–µ–º –µ–≥–æ –Ω–µ–ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–º, –¥–æ–±–∞–≤–ª—è—è "!")
    ‚óè –§–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: /etc/login.defs
_Examples:_
```bash
usermod -[L|U] <user_name>  # –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        [-g | --gid] <group>    # –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –ø–µ—Ä–≤–∏—á–Ω—É—é –ì–†–£–ü–ü–£
cat /etc/login.defs         # –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
newgrp adm                  # –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –≥—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
> 0:16 –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

adduser

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
| —É—Ç–∏–ª–∏—Ç–∞  | –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ                       |
| -------- | -------------------------------- |
| useradd  | ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è          |
| adduser  | ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–∫—Ä–∏–ø—Ç) |
| usermod  | ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è         |
| userdel  | ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è          |
| passwd   | ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è               |
| chage    | ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤ –ø–∞—Ä–æ–ª—è       |
| groupadd | ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã                |
| groupdel | ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã                |
| id       | ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–π—Å—Ç–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  |

```bash
 ‚ï≠‚îÄalex@smith in ~ took 0s
 ‚ï∞‚îÄŒª id
uid=1000(alex) gid=1000(alex) –≥—Ä—É–ø–ø—ã=1000(alex),3(sys),96(scanner),209(cups),955(libvirt),956(sambashare),969(realtime),985(video),991(lp),992(kvm),994(input),998(wheel)
```

### –ú–µ—Ö–∞–Ω–∏–∑–º sudo
0:24 

_substitude user do_

| –∫–æ–º–∞–Ω–¥–∞      | –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                       |
| ------------ | ------------------------------------------------ |
| su           | ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                      |
| sudo su      | ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (root)       |
| sudo         | ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã —Å –ø—Ä–∞–≤–∞–º–∏ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| /etc/sudoers | ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è sudo                              |
| visudo       | ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ                                 |


```bash
 ‚ï≠‚îÄalex@smith in ~ as üßô took 0s
[üî¥] √ó sudo visudo
...
##
## User privilege specification
##
root ALL=(ALL:ALL) ALL

## Uncomment to allow members of group wheel to execute any command
# %wheel ALL=(ALL:ALL) ALL

## Same thing without a password
# %wheel ALL=(ALL:ALL) NOPASSWD: ALL
...
```
_Example:_
```bash
# /etc/sudousers
# –¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∞–≤–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∏–∑ –ø–æ–¥ –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# –Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã cat
sample_user ALL= NOPASSWD: /usr/bin/cat
```

    root ALL=(ALL:ALL) ALL The first field indicates the username that the rule will apply to (root).

    root ALL=(ALL:ALL) ALL The first ‚ÄúALL‚Äù indicates that this rule applies to all hosts.

    root ALL=(ALL:ALL) ALL This ‚ÄúALL‚Äù indicates that the root user can run commands as all users.

    root ALL=(ALL:ALL) ALL This ‚ÄúALL‚Äù indicates that the root user can run commands as all groups.

    root ALL=(ALL:ALL) ALL The last ‚ÄúALL‚Äù indicates these rules apply to all commands.

_–ò—Å—Ç–æ—á–Ω–∏–∫: [https://www.digitalocean.com/community/tutorials/how-to-edit-the-sudoers-file](https://www.digitalocean.com/community/tutorials/how-to-edit-the-sudoers-file)_


### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
![](../files/access_rights.jpg)

#### –ë–∏—Ç—ã –¥–æ—Å—Ç—É–ø–∞
0:32 

![](../files/access_bits.png)

| —Ç–∏–ø –¥–æ—Å—Ç—É–ø–∞ | –¥–ª—è —Ñ–∞–π–ª–æ–≤       | –¥–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π                            |
| ----------- | ---------------- | ----------------------------------------- |
| r           | —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞     | –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –∏–º—ë–Ω —Ñ–∞–π–ª–æ–≤               |
| w           | –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞  | –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏           |
| x           | –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ | –¥–æ—Å—Ç—É–ø –∫ inode –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (–≤—Ö–æ–¥, –ø–æ–∏—Å–∫) |

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –±–∏—Ç—ã –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã:
- r-x - –¥–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- r-- - –¥–ª—è —Ñ–∞–π–ª–∞

#### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –±–∏—Ç—ã
0:36 
![](../files/spec_access_bits.jpg)


- -s   SUID
- -s   SGID
- -t   Sticky bit 

```bash
 ‚ï≠‚îÄalex@smith in ~ as üßô took 3m39s
 ‚ï∞‚îÄŒª stat /usr/bin/passwd 
  –§–∞–π–ª: /usr/bin/passwd
  –†–∞–∑–º–µ—Ä: 80856     	–ë–ª–æ–∫–æ–≤: 160        –ë–ª–æ–∫ –í/–í: 4096   –æ–±—ã—á–Ω—ã–π —Ñ–∞–π–ª
–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: 0/35	–ò–Ω–æ–¥–∞: 8380183     –°—Å—ã–ª–∫–∏: 1
–î–æ—Å—Ç—É–ø: (4755/-rwsr-xr-x)  Uid: (    0/    root)   Gid: (    0/    root)
–î–æ—Å—Ç—É–ø:        2025-03-25 22:28:46.000000000 +0700
–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω: 2025-03-20 21:22:48.000000000 +0700
–ò–∑–º–µ–Ω—ë–Ω:       2025-03-25 22:28:46.419365817 +0700
–°–æ–∑–¥–∞–Ω:        2025-03-25 22:28:46.419365817 +0700
```


_–ò—Å—Ç–æ—á–Ω–∏–∫: [https://www.gnu.org/software/coreutils/manual/html_node/Changing-Special-Mode-Bits.html](https://www.gnu.org/software/coreutils/manual/html_node/Changing-Special-Mode-Bits.html)_

#### umask –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

|                    | —Ñ–∞–π–ª | –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è |
| ------------------ | ---- | ---------- |
| –ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞       | 666  | 777        |
| umask              | 022  | 022        |
| –ø—Ä–∞–≤–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | 644  | 755        |

## ACL access control list

-  –ü–æ–≤—ã—à–µ–Ω–∏–µ –≥–∏–±–∫–æ—Å—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
-  –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
-  –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —É—Ç–∏–ª–∏—Ç

#### getfacl
```bash
# –ø–æ–∫–∞–∑–∞—Ç—å ACL
 ‚ï≠‚îÄalex@smith in ~ took 0s
 ‚ï∞‚îÄŒª getfacl backups/
# file: backups/
# owner: alex
# group: alex
user::rwx
group::r-x
other::r-x
```
#### setfacl

    setfacl -u:[uid] <dir>
            -g:[gid] <dir>


```bash
setfacl -m u:zabbix:rw test_file # —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ACL
setfacl -x u:zabbix FILE        # —É–±—Ä–∞—Ç—å ACL
setfacl -m d:u:vagrant:rwx -R /usr/local/upload/ #—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ ACL (—Ç–æ–ª—å–∫–æ –¥–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π)
```

#### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã —Ñ–∞–π–ª–æ–≤
0:57 

    chattr +i test_file     # –∏–∑–º–µ–Ω–µ–Ω–∏–µ
    lsattr                  # –ø—Ä–æ—Å–º–æ—Ç—Ä

–ê—Ç—Ä–∏–±—É—Ç—ã:
    
    ‚óã a ‚Äî —Ñ–∞–π–ª –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
    ‚óã A ‚Äî –Ω–µ –æ–±–Ω–æ–≤–ª—è—Ç—å –≤—Ä–µ–º—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏
    ‚óã c ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∂–∏–º–∞—Ç—å –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –¥–∏—Å–∫
    ‚óã C ‚Äî –æ—Ç–∫–ª—é—á–∏—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏
    ‚óã i ‚Äî —Å–¥–µ–ª–∞—Ç—å –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–º (–¥–∞–∂–µ –¥–ª—è root) IMMUTABLE
    ‚óã s ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å—é –Ω—É–ª—è–º–∏

# 2. Capabilities (–ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏)
1:06

–ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö Unix-–ø–æ–¥–æ–±–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–∞–º, –∑–∞–ø—É—â–µ–Ω–Ω—ã–º —Å –ø—Ä–∞–≤–∞–º–∏ root (uid==0)
- CAP_SYS_ADMIN     -   —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- CAP_SYS_BOOT      -   —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤—ã–∑–æ–≤—ã –∫ reboot
- CAP_SYS_CHROOT    -   —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤—ã–∑–æ–≤—ã –∫ chroot
- ...

> _man capabilities_

### —Ñ–ª–∞–≥–∏ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞
- _**Permitted**_   ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- _**Inheritable**_ ‚Äî –º–æ–∂–Ω–æ —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å –ø–æ—Ç–æ–º–∫–∞–º
- _**Effective**_   ‚Äî –∫–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å
- _**Bounding**_ (–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—â–∏–π –Ω–∞–±–æ—Ä) ‚Äî –¥–æ Linux 2.6.25 –±—ã–ª –æ–±—â–µ—Å–∏—Å—Ç–µ–º–Ω—ã–º
–∞—Ç—Ä–∏–±—É—Ç–æ–º, –æ–±—â–∏–º –¥–ª—è –≤—Å–µ—Ö –ø–æ—Ç–æ–∫–æ–≤, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∞–±–æ—Ä–∞, –∑–∞
–ø—Ä–µ–¥–µ–ª—ã –∫–æ—Ç–æ—Ä–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Ä–∞—Å—à–∏—Ä—è—Ç—å—Å—è –Ω–µ –º–æ–≥—É—Ç. –í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è —ç—Ç–æ
–Ω–∞–±–æ—Ä –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ –∏ —è–≤–ª—è–µ—Ç—Å—è –ª–∏—à—å —á–∞—Å—Ç—å—é –ª–æ–≥–∏–∫–∏ execve
- _**Ambient**_ (–Ω–∞—Ä—É–∂–Ω—ã–µ, –Ω–∞—á–∏–Ω–∞—è —Å Linux 4.3) ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã, —á—Ç–æ–±—ã –ª–µ–≥—á–µ
–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–µ-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è setuid
–∏–ª–∏ —Ñ–∞–π–ª–æ–≤—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

### —Ñ–ª–∞–≥–∏ –¥–ª—è —Ñ–∞–π–ª–∞

- Permitted     ‚Äî —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –¥–ª—è —Ñ–∞–π–ª–∞
- Inheritable   ‚Äî —Å–ø–∏—Å–æ–∫ —Å–≤–æ–π—Å—Ç–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è
- Effective     ‚Äî –±–∏—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è permitted set

### –ø—Ä–æ—Å–º–æ—Ç—Ä –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞
```bash 
cat /proc/self/status | grep Cap
CapInh: 0000000000000000
CapPrm: 000001ffffffffff
CapEff: 000001ffffffffff
CapBnd: 000001ffffffffff
CapAmb: 0000000000000000

capsh --decode=000001ffffffffff
```
### —É—Ç–∏–ª–∏—Ç—ã
|                 | –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                 |
| --------------- | ---------------------------------------------------------- |
| setcap          | ‚Äì —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏ —É–¥–∞–ª—è–µ—Ç capabilities –Ω–∞ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª |
| getcap/getpcaps | - —É–∑–Ω–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ capabilities                        |

```bash
 ‚ï≠‚îÄalex@smith in ~ as üßô took 0s
[üî¥] √ó setcap -h
usage: setcap [--license] [-f] [-h] [-n <rootid>] [-q] [-v] (-r|-|<caps>) <filename> [ ... (-r|-|<capsN>) <filenameN> ]

 Note <filename> must be a regular (non-symlink) file.
 -r          remove capability from file
 -           read capability text from stdin
 <capsN>     cap_from_text(3) formatted file capability
 [ Note: capsh --suggest="something..." might help you pick. ]
 --license   display the license info
 -f          force setting even when the capability is invalid
 -h          this message and exit status 0
 -n <rootid> write a user namespace (!= 0) limited capability
 -q          quietly
 -v          validate supplied capability matches file

setcap cap_net_admin,cap_net_raw+eip /usr/bin/tcpdump
setcap -r /usr/bin/ping
getcap /usr/bin/tcpdump
```
_Example:_

```bash
docker run -d --name=wg-easy -e WG_HOST=176.124.1.42 \
-e WG_MTU=1280 -e PASSWORD='11111111111' \
-v ~/.wg-easy:/etc/wireguard \
-p 51820:51820/udp -p 51821:51821/tcp \
--cap-add=NET_ADMIN --cap-add=SYS_MODULE \
--sysctl="net.ipv4.conf.all.src_valid_mark=1" \
--sysctl="net.ipv4.ip_forward=1" --restart unless-stopped \
weejewel/wg-easy
```
### —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

```bash
su - vagrant
export -p > ./savedenv
sudo capsh --caps="cap_net_raw+eip
cap_setpcap,cap_setuid,cap_setgid+ep" --keep=1 --user=vagrant -- -c
"source ./savedenv; rm ./savedenv; /usr/bin/env bash"
capsh --print
whoami
echo $$
```

# 3. polkit (PolicyKit)
Polkit (–ø—Ä–µ–∂–Ω–µ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: PolicyKit) ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è UNIX-–ø–æ–¥–æ–±–Ω—ã—Ö
–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

- API –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º
–ø—Ä–æ—Ü–µ—Å—Å–∞–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π, —Ç—Ä–µ–±—É—é—â–∏—Ö –ø—Ä–∞–≤
–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- Polkit –ø—Ä–æ—Ç–∏–≤–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Ç–∞–∫–∏—Ö —Å–∏—Å—Ç–µ–º, –∫–∞–∫ sudo, –Ω–æ –Ω–µ
–Ω–∞–¥–µ–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ç–æ—á–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ, –∞ —á—Ç–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ

###  —É—Ç–∏–ª–∏—Ç—ã
|            |                                                                                                                                                |
| ---------- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| pkaction   | ‚Äî —Å–ª—É–∂–∏—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç PolicyKit                                                                       |
| pkcheck    | ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–ª—Å—è –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è                                                                        |
| pkexec     | ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º—É –æ—Ç –∏–º–µ–Ω–∏ –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                                                        |
| pkttyagent | ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —Ç–∞–∫–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, ssh |

```bash
# –í–∫–ª—é—á–∞–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
$ vim /etc/polkit-1/rules.d/00-access.rules
polkit.addRule(function(action, subject) {
polkit.log("action=" + action);
polkit.log("subject=" + subject);
});
```
```bash
# –ü—Ä–∞–≤–æ –Ω–∞ –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ systemd
$ vim /etc/polkit-1/rules.d/01-systemd.rules
polkit.addRule(function(action, subject) {
if (action.id.match("org.freedesktop.systemd1.manage-units") &&
subject.user === "ivan") {
return polkit.Result.YES;
}
});
```


1:31
# 4. PAM (Pluggable Authentication Modules)
### –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
> /etc/pam.d/

- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
    - type control module-path module-arguments

- –í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ —Å—Ç–µ–∫–∞ (type) –µ—Å—Ç—å –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ
–º–æ–¥—É–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –ø–æ –ø–æ—Ä—è–¥–∫—É (—Å–≤–µ—Ä—Ö—É-–≤–Ω–∏–∑)
- –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç control-–∞ (sufficient, required) –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–±–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è,
–ª–∏–±–æ –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç—Å—è

### –¢–∏–ø—ã –º–æ–¥—É–ª–µ–π

|          |                                     |                                                                                                                                |
| -------- | ----------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| auth     | –ú–æ–¥—É–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏               | –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö                                                        |
| account  | –ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–µ—Ç–Ω—ã–º–∏ –∑–∞–ø–∏—Å—è–º–∏ | –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –¥–æ—Å—Ç—É–ø–æ–º, –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –∑–∞–ø–∏—Å–µ–π, –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –¥–ª—è –ø–∞—Ä–æ–ª–µ–π –∏ —Ç. –¥. |
| session  | –ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∞–Ω—Å–∞–º–∏          | –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–µ–∞–Ω—Å–æ–≤                                                                                 |
| password | –ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è–º–∏          | –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –ø–∞—Ä–æ–ª—è                                                                |


### control

|            |                                                                                                                                  |
| ---------- | -------------------------------------------------------------------------------------------------------------------------------- |
| required   | ‚Äî –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —ç—Ç–æ—Ç –º–æ–¥—É–ª—å –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–æ—Ç–∞—Ç—å, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞            |
| requisite  | ‚Äî –∫–∞–∫ required, —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—à–∏–±–∫–µ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç—Å—è. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ –ø–µ—Ä–≤–æ–≥–æ required/requisite –º–æ–¥—É–ª—è –≤–µ—Ä–Ω—É–≤—à–µ–≥–æ –æ—à–∏–±–∫—É |
| sufficient | ‚Äî –ø—Ä–∏ —É—Å–ø–µ—Ö–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è OK –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è                                                                              |
| optional   | ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å. –£—Å–ø–µ—Ö –∏–ª–∏ –û—à–∏–±–∫–∞ –≤–∞–∂–Ω—ã —Ç–æ–ª—å–∫–æ –≤ —Å–ª—É—á–∞–µ –µ—Å–ª–∏ —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å –≤ —Å—Ç–µ–∫–µ                               |
| include    | ‚Äî –≤–∫–ª—é—á–∏—Ç—å –≤ —Ç–µ–∫—É—â–∏–π —Å—Ç–µ–∫ –º–æ–¥—É–ª–µ–π —Å—Ç–µ–∫ –º–æ–¥—É–ª–µ–π –∏–∑ —Ñ–∞–π–ª–∞                                                                          |
| substack   | ‚Äî –≤–∫–ª—é—á–∏—Ç—å –≤ —Ç–µ–∫—É—â–∏–π —Å—Ç–µ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–¥—É–ª–µ–π –∏–∑ —Ñ–∞–π–ª–∞                                                                             |

> required: [success=ok new_authtok_reqd=ok ignore=ignore default=bad]
> requisite: [success=ok new_authtok_reqd=ok ignore=ignore default=die]
> sufficient: [success=done new_authtok_reqd=done default=ignore]
> optional: [success=ok new_authtok_reqd=ok default=ignore]



1:40 –î–ó

### pam_script
_–° –ø–æ–º–æ—â—å—é –ø–∞–∫–µ—Ç–∞ pam_script –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –∏ –≥–∏–±–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å AAA –ø—Ä–æ—Ü–µ—Å—Å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ PAM_

|                |                                                         |
| -------------- | ------------------------------------------------------- |
| pam_succeed_if | ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Ö–æ–¥ —Ç–æ–ª—å–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–º –≥—Ä—É–ø–ø–∞–º                |
|                | ```bashauth required pam_succeed_if.so gid=1000,2000``` |
| pam_deny       | ‚Äî –≤—Å–µ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å                                         |
| pam_unix       | ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è —á–µ—Ä–µ–∑ shadow                          |
| pam_mysql      | ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ mysql                     |
| pam_cracklib   | ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª–∏—Ç–∏–∫ –ø–∞—Ä–æ–ª—è                              |
| pam_rootok     | ‚Äî —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ä—É—Ç—É –æ–±—Ö–æ–¥–∏—Ç—å –¥–æ–ø. –ø—Ä–æ–≤–µ—Ä–∫–∏                |
| pam_limits     | ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π                   |


